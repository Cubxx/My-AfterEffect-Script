// Cubxx shawn6304@qq.com 2024/6/25 02:24:14
(function(){var r=Array.prototype;var e=Object.prototype;var n=e.hasOwnProperty;var t=r.concat;var o=r.slice;var u=e.toString;var a=9007199254740991;var i=/\w*$/;var c=/^(?:0|[1-9]\d*)$/;function f(r,e){return null!=r&&n.call(r,e)}function l(r){if(null==r)return!1;var e=typeof r;return"object"===e||"function"===e}function s(r,e){var n=Object(r);if(l(e))for(var t in e)if(f(e,t))n[t]=e[t];return n}function p(r,e){var n=-1;var t=r.length;for(;++n<t;)if(r[n]===e)return!0;return!1}function v(r){if(null==r)return void 0===r?"[object Undefined]":"[object Null]";else return u.call(r)}function d(r){return"[object Array]"==v(r)}function y(){var r=-1;var e=arguments.length;for(;++r<e;)if(arguments[r])return!0;return!1}function h(){return!1}function g(r,e){var n=-1;var t=null==r?0:r.length;var o=new Array(t);for(;++n<t;)o[n]=e(r[n],n,r);return o}function m(r,e){return!!(e=null==e?a:e)&&y("number"===typeof r,c.test(r))&&r>-1&&r%1==0&&r<e}function _(r,e){var n=d(r);var t=!n&&function(r){return function(r){return"object"==typeof r&&null!==r}(r)&&"[object Arguments]"==v(r)}(r);var o=n||t;var u=r.length;var a=new Array(o?u:0);var i=o?-1:u;for(;++i<u;)a[i]="".concat(i);for(var c in r)if(f(r,c)&&(!o||"length"!==c&&!m(c,u)))a.push(c);return a}function b(r){return null!=r&&"function"!=typeof r&&function(r){return"number"==typeof r&&r>-1&&r%1==0&&r<=a}(r.length)}function x(r,e){var n=-1;var t=0;var o=null==r?0:r.length;var u=[];for(;++n<o;){var a=r[n];if(e(a,n,r))u[t++]=a}return u}var w="[object Arguments]";var j="[object Boolean]";var A="[object Date]";var k="[object Number]";var S="[object Object]";var E="[object RegExp]";var P="[object String]";var L={};L[w]=L["[object Array]"]=L[j]=L[A]=L[k]=L[S]=L[E]=L[P]=!0;L["[object Error]"]=!1;function B(r,e){var n=r.constructor;switch(e){case j:case A:return new n(r.valueOf());case k:case P:return new n(r);case E:return function(r){var e=i.exec(r.toString());var n=null===e?void 0:e.toString();var t=new(0,r.constructor)(r.source,n);t.lastIndex=r.lastIndex;return t}(r)}}function I(r){var e=r.length;var n=new(0,r.constructor)(e);if(e&&function(r){return"string"==typeof r[0]&&f(r,"index")}(r)){n.index=r.index;n.input=r.input}return n}function G(r,e,n,t,o,u,a){var i;if(void 0!==i)return i;if(!l(r))return r;var c=d(r);var s=v(r);if(c)return function(r,e){var n=-1;var t=r.length;e||(e=new Array(t));for(;++n<t;)e[n]=r[n];return e}(r,i=I(r));else{var p="function"==typeof r;if(y(s==S,s==w,p&&!o)){i=p?{}:function(r){var e=r.constructor;return"function"==typeof e&&e instanceof e?new e:{}}(r);return function(r,e,n){n||(n={});var t=-1,o=e.length;for(;++t<o;){var u=e[t];n[u]=r[u]}return n}(r,function(r){if(null==r)return[];if(b(r))return _(r);var e=[];for(var n in r)if(f(r,n))e.push(n);return e}(r),i)}else return L[s]?B(r,s):o?r:{}}}function D(r,e){var n=-1;var t=r.length;for(;++n<t&&!1!==e(r[n],n,r););return r}function V(r){return r!=r}function C(r,e){return!!(null==r?0:r.length)&&function(r,e,n){return e==e?function(r,e,n){var t=n-1;var o=r.length;for(;++t<o;)if(r[t]===e)return t;return-1}(r,e,n):function(r,e,n,t){var o=r.length;var u=n+-1;for(;++u<o;)if(e(r[u],u,r))return u;return-1}(r,V,n)}(r,e,0)>-1}function N(r,e){var n=-1;var t=r.length;for(;++n<t;)if(e(r[n],n,r))return!0;return!1}function R(r,e){for(var n in r)if(f(r,n))if(!1===e(r[n],n,r))break;return r}function U(r){return null==r}function T(r){return null!=r&&r.length?function(r,e,n){var t=-1;var o=C;var u=[];var a=u;var i=r.length;a=u;r:for(;++t<i;){var c=r[t];var f=c;c=0!==c?c:0;if(f==f){var l=a.length;for(;l--;)if(a[l]===f)continue r;u.push(c)}else if(!o(a,f)){if(a!==u)a.push(f);u.push(c)}}return u}(r):[]}function O(r){return function(e){return null!=e&&e instanceof r}}var M=O(Panel);var W=O(Window);var z=this;var F=$.global;var K={version:"beta 1.0.0",parse:function(r){e=[Window,Panel,Group],D(e,(function(r){var e=r.prototype;e.getElementById=br;e.getElementsByName=wr;e.getElementsByType=jr;_r(e,"getElementById");_r(e,"getElementsByName");_r(e,"getElementsByType")}));var e;var n=l(r)?r:{};var t=dr.apply(null,function(r,e){var n=s((t=J,G(t)),function(r){return cr(r,"config")}(r));var t;var o=Boolean(n.show);var u=Boolean(n.dockable);var a=Boolean(n.singleton);var i=function(r,e,n){if(n||!e)return Window;if(Sr(z))return z;return Sr(r)?r:Window}(e.context,u,a);var c=function(r,e){if(p(Q,e))return e;if(p(Q,r))return r;return 0}(e.layoutMode,n.layoutMode);return[a,r,i,o,c]}(n,K));K.windows.push(t);return t},windows:[]};var Q=[0,1,2];var H=["dialog","palette","window"];var J={dockable:!0,show:!0,singleton:!1};var q={button:3,checkbox:3,dropdownlist:3,edittext:3,iconbutton:3,image:3,listbox:3,progressbar:4,radiobutton:3,scrollbar:5,slider:5,statictext:3,treeview:3};var X={group:2,panel:3,tab:3,tabbedpanel:3};var Y={button:"A",checkbox:"B",dialog:"C",dropdownlist:"D",edittext:"E",group:"G",iconbutton:"H",image:"I",item:"J",listbox:"K",node:"L",palette:"M",panel:"N",progressbar:"O",radiobutton:"P",scrollbar:"Q",slider:"R",statictext:"S",tab:"T",tabbedpanel:"U",treeview:"V",window:"W"};var Z=/[CGMNTW][ABDEFGHIKNOPQRSUV]|[DK]J|[VL][LJ]|UT/;var rr=hr(/[DGKLNTUV]/),er=hr(/[DKLV]/),nr=hr(/[GNTU]/),tr=hr(/[ABDEHIKOPQRSV]/),or=hr(/[DKUV]/);function ur(r,e,n,t){return"node"==n?function(r,e,n,t){var o=xr(e);var u=function(r,e){return r.add("node",e)}(r,Ar(e));if(o.expanded)t.nodeItems.push(u);delete o["expanded"];s(u,o);return u}(r,e,0,t):function(r,e,n,t){var o=xr(e);var u=function(r,e,n){return r.add(e,n[1],n[2],n[3])}(r,n,ir(e,n));if(or(n)&&f(o,"selection")){var a={container:u,itemIndex:o.selection};t.selectableElement.push(a);delete o["selection"];return s(u,o)}s(u,o);return u}(r,e,n,t)}function ar(r,e,n,t){var o=er(r.type)?function(r,e,n,t){return o=r,u=Ar(e),o.add("item",u);var o,u}(r,e):function(r,e,n,t){return function(r,e,n){return r.add(e,n[1],n[2],n[3],n[4],n[5])}(r,n,ir(e,n))}(r,e,n);s(o,xr(e))}function ir(r,e){return function(r,e){var n=r[0];if(U(n))return r;var t=function(r){if(tr(r))return q[r];if(nr(r))return X[r];return 0}(e);var o=r[t];if(!l(o))r[t]={};if(f(o,"name"))return r;r[t].name=n;return r}(function(r){return d(r)?Er(r):lr(r)}(r),e)}function cr(r,e){return U(r)?void 0:r[e]}function fr(r){var e=r.properties;return e&&e.name}function lr(r){var e=cr(r,"param");return d(e)?Er(e):[]}function sr(r){var e=cr(r,"style");return l(e)?e:{}}function pr(r,e,n,t){var o=yr(r,e);kr(o,t);if(W(o)&&n)o.show();return o}function vr(r,e,n,t){var o;return function(){if(function(r){return U(r)||!r.visible}(o))o=yr(r,e);kr(o,t);if(W(o)&&n)o.show();return o}}function dr(r){return(r?vr:pr).apply(null,o.call(arguments,1))}function yr(r,e){var n=function(r,e){var n=function(r,e){return M(e)?e:new Window(r[0],r[1],r[2],r[3])}(function(r){var e=String(r[0]);r[0]=p(H,e)?e:["palette"];return r}(lr(r)),e);n.onResizing=n.onResize=function(){this.layout.resize()};s(n,sr(r));return n}(r,e);var t={nodeItems:[],selectableElement:[]};Pr(r,n,t);D(t.selectableElement,(function(r){var e=r.container;var n=r.itemIndex;if("tabbedpanel"==e.type)e.selection=n;else e.selection=g(function(r){return d(r)?r:[r]}(n),(function(r){return e.items[r]}))}));D(t.nodeItems,(function(r){r.expanded=!0}));return n}function hr(r){return function(e){if(f(Y,e))return r.test(Y[e]);else return!1}}function gr(r,e,n,t){return N(r,(function(r){var o=[];return N(r.children,(function(r){if(nr(r.type))o.push(r);if(t(r))e.push(r);return n(e)}))?!0:gr(o,e,n,t)}))}function mr(r){return T(g(t.apply([],r),String))}function _r(r,e){r.watch(e,(function(r,e){return e}))}function br(r){var e=String(r);var n=[];gr([this],n,(function(r){return r.length>0}),(function(r){var n=fr(r);if(U(n))return!1;else return e===n}));return 0===n.length?null:n[0]}function xr(r){return d(r)?{}:sr(r)}function wr(){var r=mr(arguments);var e=[];var n=[];gr([this],n,(function(){return r.length===e.length}),(function(n){var t=fr(n);if(U(t))return!1;if(p(r,t)&&!p(e,t)){e.push(t);return!0}return!1}));return 0===n.length?null:n}function jr(){var r=mr(arguments);var e=[];gr([this],e,h,(function(e){return p(r,e.type)}));return 0===e.length?null:e}function Ar(r){var e=l(r)?function(r){return cr(r,"param")}(r):r;return String(e)}function kr(r,e){r.layout.layout(e);r.layout.resize()}function Sr(r){return r===F||M(r)}function Er(r){return g(r,(function(r){return function(r){return null===r}(r)?void 0:r}))}function Pr(r,e,n){R(r,(function(r,t){var o=(u=t,u.replace(/\d/g,"")).toLowerCase();var u;if(function(r){return f(Y,r)}(o)&&(a=e.type,i=o,c=Y[a]+Y[i],Z.test(c)))if(rr(o)){Pr(r,ur(e,r,o,n),n)}else ar(e,r,o);var a,i,c}))}function Lr(r,e){var n=0;var t=r.numProperties+1;for(;++n<t&&!1!==e(r.property(n),n,r););return r}function Br(r,e){app.beginUndoGroup(r);e();app.endUndoGroup()}var Ir={abort:function(r){if(!$.level)alert(r,"Abort");throw r},checkLength:function(r,e,n){if(void 0===n)n=1;if(r.length<n)Ir.abort(e)},emptyArray:function(r){var e={};var n=x(g(r,(function(r,n){if(r instanceof PropertyGroup){return{parentProperty:r.parentProperty,propertyIndex:r.propertyIndex}}else e[n]=r})),(function(r){return!!r}));g(n,(function(r){(0,r.parentProperty)(r.propertyIndex).remove()}));R(e,(function(r){return r.remove()}))}};var Gr={set_undo_group:function(r,e){if(void 0===e)e=(new Date).getTime()+"";return function(){return Br("cubx."+e,r)}},get_active_comp:function(){var r=app.project.activeItem;return r instanceof CompItem?r:Ir.abort("请在时间轴上打开合成")},get_selected_comps:function(){var r=x(app.project.selection,(function(r){return r instanceof CompItem}));Ir.checkLength(r,"请在项目面板中选择合成");return r},get_selected_layers:function(){var r=this.get_active_comp().selectedLayers;Ir.checkLength(r,"请选择图层");return r},get_selected_properties:function(){var r=this.get_selected_layers();var e=[];D(r,(function(r){e=e.concat(r.selectedProperties)}));return e},add_layer:function(r){var e,n;if(void 0===r)r="Shape";return null===(n=(e=this.get_active_comp().layers)["add"+r])||void 0===n?void 0:n.call(e)},add_solid_layer:function(r){if(void 0===r)r=[.5,.5,.5,1];var e=this.add_layer();e.name="Solid";var n=e.property("ADBE Root Vectors Group");n.addProperty("ADBE Vector Shape - Rect").property("Size").setValue([e.width,e.height]);n.addProperty("ADBE Vector Graphic - Fill").property("Color").setValue(r);return e},add_adjustment_layer:function(){var r=this.add_solid_layer();r.name="Adjustment";r.label=5;r.adjustmentLayer=!0;return r},add_null_layer:function(){var r=this.add_layer();r.name="Null";r.label=1;r.transform.scale.expression="[100, 100]";r.transform.opacity.setValue(0);r.property("ADBE Root Vectors Group").addProperty("ADBE Vector Shape - Rect");return r},add_layer_from_group:function(r){var e=r.propertyGroup(2);if(!(e instanceof ShapeLayer))Ir.abort("请选择 形状层 - 内容(Contents) 的子属性组");var n=e.duplicate();n.name=[e.name,r.name].join(" - ");var t=n.property("ADBE Root Vectors Group");var o=[];Lr(t,(function(e,n){n+1!=r.propertyIndex&&e&&o.push(e)}));Ir.emptyArray(o);return n},add_layers_from_selected_groups:function(){var r=this;var e=x(this.get_selected_properties(),(function(r){return r instanceof PropertyGroup&&!(r instanceof MaskPropertyGroup)}));Ir.checkLength(e,"请选择属性组(除蒙版以外)");var n=g(e,(function(e){return r.add_layer_from_group(e),e}));Ir.emptyArray(n)},unpack_comp:function(r){r.selected=!0;var e=r.containingComp,n=r.startTime;var t=r.source.layers;for(var o=1;o<=t.length;o++){t[o].copyToComp(e);e.layers[r.index-1].startTime+=n}r.selected=!1},unpack_selected_comps:function(){var r=x(this.get_selected_layers(),(function(r){r.selected=!1;return r instanceof AVLayer&&r.source instanceof CompItem}));Ir.checkLength(r,"请选择合成图层");var e=g(r,(function(r,e){return Gr.unpack_comp(r),r.source}));Ir.emptyArray(e)},unpack_layer:function(r){r.selected=!0;var e=r.property("ADBE Root Vectors Group");var n=[];Lr(e,(function(r){r instanceof PropertyGroup&&!(r instanceof MaskPropertyGroup)&&n.push(r)}));Ir.checkLength(n,"".concat(r.name," 图层只有 ").concat(n.length," 个属性组"),2);g(n,this.add_layer_from_group);r.selected=!1},unpack_selected_layers:function(){var r=x(this.get_selected_layers(),(function(r){r.selected=!1;return r instanceof ShapeLayer}));Ir.checkLength(r,"请选择形状图层");var e=g(r,(function(r){return Gr.unpack_layer(r),r}));Ir.emptyArray(e)},render:function(){app.project.renderQueue.showWindow(!0);app.project.renderQueue.render()},render_active_comp:function(){this.render_comp(this.get_active_comp())},render_selected_comps:function(){g(this.get_selected_comps(),this.render_comp)},render_comp:function(r){var e=app.project.renderQueue.items.add(r);this.render_setting(e);e.render=!0},render_setting:function(r){if(!app.project.file)return alert("请先保存项目");r.outputModule(1).setSettings({"Output File Info":{"Base Path":app.project.file.fsName.replace(/\\[^\\]+$/,""),"Subfolder Path":"render","File Name":r.comp.name}})},fix_expression:function(){var r=[["点","Point"],["3D点","3D Point"],["角度","Angle"],["滑块","Slider"],["颜色","Color"],["复选框","Checkbox"],["菜单","Menu"],["图层","Layer"]];var e={zh_CN:function(){g(r,(function(r){var e=r[0],n=r[1];return app.project.autoFixExpressions(n,e)}))},en_US:function(){g(r,(function(r){var e=r[0],n=r[1];return app.project.autoFixExpressions(e,n)}))}};if(f(e,app.isoLanguage))e[app.isoLanguage]()}};var Dr=function(r,e,n){var t=r.length;if(0!==t||void 0!==n){var o=void 0===n?r[0]:n;var u=void 0===n?0:-1;for(;++u<t;)o=e(o,r[u],u,r);return o}}([["UC",Gr.unpack_selected_comps],["UL",Gr.unpack_selected_layers],["AS",Gr.add_solid_layer],["AA",Gr.add_adjustment_layer],["AN",Gr.add_null_layer],["AG",Gr.add_layers_from_selected_groups],["R",Gr.render_selected_comps],["F",Gr.fix_expression]],(function(r,e,n){var t=e[0],o=e[1];r["button"+n]={style:{text:t,preferredSize:[30,30],onClick:function(){return Br(t,o)}}};return r}),{style:{orientation:"column",alignChildren:"center",margins:0,spacing:0,text:"toolbox"}});K.context=this;K.parse(Dr)}).call(this);
